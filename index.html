<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cardiorenal Journey — Patient Stories</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            base: { DEFAULT: '#0f172a', card: '#111827', border: '#243244', soft: '#1f2937' },
            tealgrad: { start: '#0ea5e9', end: '#14b8a6' },
          }
        }
      }
    }
  </script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .gradient-header { background: linear-gradient(90deg, #0ea5e9, #14b8a6); }
    .card { @apply rounded-2xl border border-base-border bg-base-card p-4 md:p-5 shadow-lg shadow-black/10; }
    .light body { background: #f6f7fb; }
    .light .card { background: #fff; border-color: #e5e7eb; box-shadow: 0 8px 22px rgba(0,0,0,.06); }
    .kpi-bar { height:6px; border-radius:6px; overflow:hidden; background:#1f2937; margin-top:6px; }
    .kpi-bar-fill { height:100%; transition:width .5s ease, background .5s ease; }
    .light .kpi-bar { background:#e5e7eb; }
    .btn-tab { @apply w-full text-left rounded-xl border border-base-border p-4 transition hover:bg-white/5 cursor-pointer; }
    .btn-tab-active { @apply ring-2 ring-teal-400 bg-white/5; }
  </style>
</head>

<body class="bg-base text-white antialiased">
  <!-- Header -->
  <header class="sticky top-0 z-20 gradient-header text-white shadow-md">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <h1 class="text-xl md:text-2xl font-extrabold">Cardiorenal Journey — <span class="opacity-90">Patient Stories</span></h1>
      <button id="themeToggle" class="rounded-lg bg-white/10 px-3 py-2 text-sm font-medium hover:bg-white/20 transition">Toggle Theme</button>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-4 md:py-6 space-y-4">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
      <!-- LEFT COLUMN -->
      <section class="lg:col-span-4 space-y-4">
        <div class="card">
          <h2 class="text-lg font-semibold mb-3">Select a hypothetical patient</h2>
          <div class="grid grid-cols-2 gap-3">
            <button id="cardArjun" class="btn-tab btn-tab-active">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 grid place-items-center bg-blue-600 rounded-full font-bold">A</div>
                <div><div class="font-semibold">Arjun (35)</div><div class="text-xs text-gray-400">IT engineer, Pune</div></div>
              </div>
            </button>
            <button id="cardMeera" class="btn-tab">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 grid place-items-center bg-pink-600 rounded-full font-bold">M</div>
                <div><div class="font-semibold">Meera (41)</div><div class="text-xs text-gray-400">Teacher, Pune</div></div>
              </div>
            </button>
          </div>
          <div class="mt-4">
            <div class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium border border-white/10 bg-white/5 mb-2">Patient story</div>
            <div id="story" class="text-sm leading-relaxed text-gray-200"></div>
          </div>
        </div>

        <!-- KPI Cards -->
        <div class="grid grid-cols-2 gap-3">
          <div class="card text-center">
            <div class="text-xs uppercase text-gray-400">eGFR</div>
            <div id="egfrNow" class="text-3xl font-extrabold">—</div>
            <div id="egfrStage" class="text-xs text-gray-400"></div>
            <div class="kpi-bar"><div id="barEgfr" class="kpi-bar-fill bg-blue-500 w-0"></div></div>
          </div>
          <div class="card text-center">
            <div class="text-xs uppercase text-gray-400">KFRE 2-yr</div>
            <div id="kfre2" class="text-3xl font-extrabold">—</div>
            <div id="kfre2Cat" class="text-xs text-gray-400"></div>
            <div class="kpi-bar"><div id="barKFRE2" class="kpi-bar-fill bg-teal-400 w-0"></div></div>
          </div>
          <div class="card text-center">
            <div class="text-xs uppercase text-gray-400">KFRE 5-yr</div>
            <div id="kfre5" class="text-3xl font-extrabold">—</div>
            <div id="kfre5Cat" class="text-xs text-gray-400"></div>
            <div class="kpi-bar"><div id="barKFRE5" class="kpi-bar-fill bg-cyan-400 w-0"></div></div>
          </div>
          <div class="card text-center">
            <div class="text-xs uppercase text-gray-400">10-yr CVD</div>
            <div id="cvd10" class="text-3xl font-extrabold">—</div>
            <div id="cvdCat" class="text-xs text-gray-400"></div>
            <div class="kpi-bar"><div id="barCVD" class="kpi-bar-fill bg-rose-400 w-0"></div></div>
          </div>
        </div>
      </section>

      <!-- RIGHT COLUMN -->
      <section class="lg:col-span-8 space-y-4">
        <div class="card">
          <h3 class="font-semibold mb-2">Kidney function projection (eGFR — 5 yrs)</h3>
          <canvas id="egfrChart" height="240"></canvas>
        </div>
        <div class="card">
          <h3 class="font-semibold mb-2">CVD risk projection (10-yr PREVENT)</h3>
          <canvas id="cvdChart" height="240"></canvas>
        </div>
        <p class="text-[11px] text-gray-400 px-1">Educational simulation. Not medical advice.</p>
      </section>
    </div>
  </main>

  <script>
    const s = { profile: 'arjun', theme: 'dark' };
    const $ = id => document.getElementById(id);

    const dom = {
      cardArjun: $('cardArjun'), cardMeera: $('cardMeera'), story: $('story'),
      egfrNow:$('egfrNow'), egfrStage:$('egfrStage'), kfre2:$('kfre2'),
      kfre5:$('kfre5'), cvd10:$('cvd10'), kfre2Cat:$('kfre2Cat'), kfre5Cat:$('kfre5Cat'),
      cvdCat:$('cvdCat'), barEgfr:$('barEgfr'), barKFRE2:$('barKFRE2'),
      barKFRE5:$('barKFRE5'), barCVD:$('barCVD'), themeToggle:$('themeToggle')
    };

    function egfrCKDEPI2021(age, sex, scr) {
      const k = sex === 'female' ? 0.7 : 0.9;
      const a = sex === 'female' ? -0.241 : -0.302;
      const sexFactor = sex === 'female' ? 1.012 : 1.0;
      return Math.round(142 * Math.pow(Math.min(scr / k, 1), a) *
        Math.pow(Math.max(scr / k, 1), -1.2) * Math.pow(0.9938, age) * sexFactor);
    }

    const egfrStageText = e => e >= 90 ? 'G1' : e >= 60 ? 'G2' : e >= 45 ? 'G3a' : e >= 30 ? 'G3b' : e >= 15 ? 'G4' : 'G5';
    const kfreLP = ({age,male,egfr,uacr,bpControlled,diabetes}) =>
      (-0.2218*(age/10 - 7.036)) + (0.2553*(male - 0.5642)) - (0.5541*(egfr/5 - 7.222)) +
      (0.4562*(Math.log(uacr) - 5.137)) - (0.1475*(bpControlled - 0.5106)) + (0.1426*(diabetes - 0.8501));
    const kfreRisk = (yrs, lp) => 100 * (1 - Math.pow(yrs === 5 ? 0.937 : 0.983, Math.exp(lp)));

    const round=(v,d=1)=>Math.round(v*10**d)/10**d, clamp=(n,a,b)=>Math.max(a,Math.min(b,n));

    function kpiBar(el, val) { el.style.width = `${clamp(val,0,100)}%`; }

    function compute(){
      const age = s.profile==='arjun'?35:41, sex = s.profile==='arjun'?'male':'female';
      const egfr = egfrCKDEPI2021(age, sex, s.profile==='arjun'?1.05:1.0);
      dom.egfrNow.textContent = egfr; dom.egfrStage.textContent = egfrStageText(egfr);

      const uacr = s.profile==='arjun'?50:250;
      const lp = kfreLP({age, male:sex==='male'?1:0, egfr, uacr, bpControlled:1, diabetes:s.profile==='meera'?1:0});
      const k2 = round(kfreRisk(2,lp)), k5 = round(kfreRisk(5,lp));
      dom.kfre2.textContent=`${k2}%`; dom.kfre5.textContent=`${k5}%`;
      dom.kfre2Cat.textContent=k2<5?'Low':k2<15?'Mod':'High';
      dom.kfre5Cat.textContent=k5<5?'Low':k5<15?'Mod':'High';
      const cvd = sex==='male'?10.5:14.8; dom.cvd10.textContent=`${cvd}%`;
      dom.cvdCat.textContent=cvd<10?'Low':'Elevated';

      kpiBar(dom.barEgfr, egfr/1.2);
      kpiBar(dom.barKFRE2, k2);
      kpiBar(dom.barKFRE5, k5);
      kpiBar(dom.barCVD, cvd);

      dom.story.textContent = s.profile==='arjun'
        ? `Arjun, 35, an IT engineer from Pune, maintains good blood pressure and kidney function (eGFR ${egfr}, UACR ${uacr}).`
        : `Meera, 41, a school teacher from Pune, has mild diabetic kidney involvement with eGFR ${egfr} and UACR ${uacr}.`;
      updateCharts(s.profile, egfr);
    }

    let egfrChart, cvdChart;
    function initCharts(){
      const labels = ['0y','1y','2y','3y','4y','5y'];
      const chartCfg = { responsive:true, maintainAspectRatio:false,
        animation:{ duration:500, easing:'easeOutQuad' },
        plugins:{ legend:{display:false} },
        scales:{ y:{ beginAtZero:true, ticks:{color:'#9ca3af'} } }
      };
      egfrChart = new Chart(document.getElementById('egfrChart'),{
        type:'line', data:{labels,datasets:[{data:[],borderColor:'#0ea5e9',backgroundColor:'#0ea5e930',borderWidth:3,tension:.3}]}, options:chartCfg
      });
      cvdChart = new Chart(document.getElementById('cvdChart'),{
        type:'line', data:{labels,datasets:[{data:[],borderColor:'#14b8a6',backgroundColor:'#14b8a630',borderWidth:3,tension:.3}]}, options:chartCfg
      });
    }

    function updateCharts(profile, egfr){
      const egfrPath = [egfr, egfr-2, egfr-4, egfr-6, egfr-8, egfr-10];
      const cvdPath = profile==='arjun'?[10,10.3,10.5,10.8,11.2,11.5]:[15,15.3,15.8,16.2,16.6,17];
      egfrChart.data.datasets[0].data = egfrPath;
      cvdChart.data.datasets[0].data = cvdPath;
      egfrChart.update(); cvdChart.update();
    }

    function applyProfile(p){
      s.profile=p;
      dom.cardArjun.classList.toggle('btn-tab-active',p==='arjun');
      dom.cardMeera.classList.toggle('btn-tab-active',p==='meera');
      compute();
    }

    function setTheme(){
      const root=document.documentElement;
      s.theme=s.theme==='dark'?'light':'dark';
      root.classList.toggle('dark');
      root.classList.toggle('light');
      egfrChart.update(); cvdChart.update();
    }

    document.addEventListener('DOMContentLoaded',()=>{
      initCharts(); compute();
      dom.cardArjun.onclick=()=>applyProfile('arjun');
      dom.cardMeera.onclick=()=>applyProfile('meera');
      dom.themeToggle.onclick=()=>setTheme();
    });
  </script>
</body>
</html>
